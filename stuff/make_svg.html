<!DOCTYPE html>
<html>
  <head>
    <title>Test</title>
    <style>
      .inp1 {
        width: 6ch;
        margin-bottom: 5px;
      }
      .textdiv {
        padding-left: 5px;
        padding-right: 5px;
        display: flex;
        flex-direction: row;
        height: fit-content;
        min-height: 100%;
      }
      textarea {
        resize: vertical;
        width: 160px;
        height: 145px;
      }
      .collbtn {
        width: 15px;
        /* height: 100%; */
        margin-bottom: 2px;
      }
      #setting_box {
        position: fixed;
        display: flex;
        flex-direction: column;
      }
      #drag {
        height: 20px;
        background-color: blue;
        cursor: move;
      }
      #setting {
        display: flex;
        flex-direction: row;
        background-color: lightgray;
      }
      body {
        background-color: antiquewhite;
      }
    </style>
  <body>
    <div id="setting_box">
      <div id="drag"></div>
      <div id="setting">
        <div>
          <label for="width">width:</label>
          <input type="number" name="width" id="width" value="1024" class="inp1"
            onchange="W=self.event.target.value;svg.viewBox=`0 0 ${W} ${H}`"><br>
          <label for="height">height:</label>
          <input type="number" name="height" id="height" value="1024" class="inp1"
            onchange="H=self.event.target.value;svg.viewBox=`0 0 ${W} ${H}`;"><br>
          <label for="linew">line width:</label>
          <input type="number" name="linew" id="linew" value="2" class="inp1" onchange="LW=self.event.target.value;"><br>
          <label for="points">points size:</label>
          <input type="number" name="points" id="points" value="4" class="inp1" onchange="R=self.event.target.value;"><br>
          <label for="scale">points size:</label>
          <input type="number" name="scale" id="scale" value="1.0" class="inp1" min="0.0" step="0.01"
            onchange="Mul=self.event.target.value;"><br>
          <button onclick="update_svg();">update</button><button onclick="download_svg();">Download</button>
        </div>
        <div>
          <div class="textdiv">
            <textarea id="text1" placeholder="id x y">a 100 200
b 10 20</textarea>
            <button class="collbtn" onclick="if(text1.style.display!='none')text1.style.display='none';
            else text1.style.display='block';"></button>
          </div>
        </div>
        <div>
          <div class="textdiv">
            <textarea id="text2" placeholder="id1 id2">a b</textarea>
            <button class="collbtn" onclick="if(text2.style.display!='none')text2.style.display='none';
            else text2.style.display='block';"></button>
          </div>
        </div>
      </div>
    </div>
    <a id='download1' download='file.svg' type='text/svg' style="display: none;"></a>
    <div id="data">
      <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" id="svg" viewBox="0 0 1024 1024">
      </svg>
    </div>
    <script>
      const text1=document.getElementById('text1');
      const text2=document.getElementById('text2');
      const svg_elm = document.getElementById("svg");
      const a = document.getElementById('download1');
      var W=1024,H=1024,LW=2,R=4, Mul=1.0;
      var points = {};
      var elms = [];
      function min(a,b){if (a<b)return a;else return b;}
      function max(a,b){if (a<b)return b;else return a;}
      function create_svg_elements(){
        elms = [];
        points = {};
        for (let s of text1.value.split("\n")){
          let m = s.match(/^([^ ]+) (-?\d+(?:\.\d+)?) (-?\d+(?:\.\d+)?)$/);
          if (m){
            let x=(Number(m[2]))*Mul+W/2,y=Number(m[3])*Mul+H/2;
            points[m[1]] = [x,y];
            elms.push(`<circle r="${R}" cx="${x}" cy="${y}" fill="black" />`);
          }
        }
        for (let s of text2.value.split("\n")){
          let m = s.match(/^([^ ]+) ([^ ]+)$/);
          if (m){
            let [x1,y1]=points[m[1]];
            let [x2,y2]=points[m[2]];
            let dx=x2-x1,dy=y2-y1;
            let m1=1e9,m2=-1e9;
            if (dx>0){
              m1=min(m1,(W-x1)/dx)
              m2=max(m2,-x1/dx)
            }
            else if (dx<0){
              m1=min(m1,-x1/dx)
              m2=max(m2,(W-x1)/dx)
            }
            if (dy>0){
              m1=min(m1,(H-y1)/dy)
              m2=max(m2,-y1/dy)
            }
            else if (dy<0){
              m1=min(m1,-y1/dy)
              m2=max(m2,(H-y1)/dy)
            }
            elms.push(`<line x1="${x1+dx*m1}" y1="${y1+dy*m1}" x2="${x1+dx*m2}" y2="${y1+dy*m2}"`+
            ` stroke="black" stroke-width="${LW}"/>`);
          }
        }
      }
      function update_svg(){
        create_svg_elements();
        svg_elm.innerHTML=elms.join('\n');
      }
      function download_svg(){
        create_svg_elements();
        let svg=`<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H}">
${elms.join('\n')}
</svg>`;
        var data = new Blob([svg]);
        a.href = URL.createObjectURL(data);
        a.click();
        URL.revokeObjectURL(a.href);
      }
    </script>
    <!-- dragbox -->
    <script>
      const drag_box = document.getElementById("setting_box");
      let drag_handle = document.getElementById("drag");
      var m_x,m_y,d_x0=drag_box.offsetLeft, d_y0=drag_box.offsetTop;
      drag_handle.onmousedown = (e) => {
        e = e|| window.event;
        e.preventDefault();
        m_x=e.clientX;
        m_y=e.clientY;
        document.onmouseup = (e) => {
          document.onmouseup=null;
          document.onmousemove=null;
        };
        document.onmousemove = (e) => {
          e = e|| window.event;
          e.preventDefault();
          d_y0 += (e.clientY - m_y);
          d_x0 += (e.clientX - m_x);
          d_y0 = max(min(d_y0, window.innerHeight-drag_box.offsetHeight),0);
          d_x0 = max(min(d_x0, window.innerWidth-drag_box.offsetWidth),0);
          drag_box.style.top = d_y0 + 'px';
          drag_box.style.left = d_x0 + 'px';
          m_x=e.clientX;
          m_y=e.clientY;
        }
      };
    </script>
</body>
</html>